<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Leonel Herrera-Alsina" />

<meta name="date" content="2022-11-09" />

<title>Using LEMAD</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using LEMAD</h1>
<h4 class="author">Leonel Herrera-Alsina</h4>
<h4 class="date">2022-11-09</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Our Lineage Extinction Model of Ancestral Distribution (LEMAD)
computes the likelihood of the modern distribution of species (given the
parameters of the model) where lineage extinction is a fundamental part
of the calculation. LEMAD generalizes the likelihood described in GeoSSE
for any number of areas and under several sets of geographic assumptions
that facilitate its use in Ancestral Distribution Estimation (ADE). In
LEMAD, the species’ geographic distribution changes over time in a
similar manner as an evolving discrete trait does in SSE models.
Lineages expand and contract their geographic distribution by colonising
new regions and going locally extinct from others; these processes take
place along the branches of the phylogenetic tree. LEMAD assumes that
rates of speciation and extinction are constant across regions. DIVA and
DEC are popular methods for ADE and they differ in the set of geographic
assumptions (see below); in a LEMAD framework, we can use both DIVA and
DEC sets of assumptions (we call them DIVAevents and DECevents).
DIVAevents assumes that widespread species can split their ranges
(vicariance) in any combination regardless the number of areas where
daughter lineages inhabit (e.g., a species presents in region A, B, C
and D can split in AB-CD or A-BCD; widespread vicariance sensu Matzke
2013) while DECevents assumes that one of the daughter lineages will be
present at a single region (e.g., ABCD species splits in A-BCD or B-ACD;
narrow vicariance). For in-situ speciation and in contrast with
DIVAevents, DECevents allows that widespread species have a given
population diverging from the rest, becoming a different species which
coexists with the parental lineage e.g., ABCD species produces ABCD and
the new species is restricted to A (in-situ subset hereafter; sympatry
subset sensu Matzke 2013). ## SecSSE input files It could be convenient
to remove all the objects in memory and then load LEMAD:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DDD)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lemad)</span></code></pre></div>
<p>Similar to the DIVA, DEC, BioGeoBears,LEMAD uses two input files: 1)
a rooted, ultrametric tree in nexus format (for conversion of other
formats to nexus, we refer to the documentation in package ‘ape’) and 2)
a data file with geographic information. This file will have two
columns, the first containing taxa names (which should match the names
in the phylogeny) and the second a code for the region where each
species inhabits (usually A,B,C, etc., but notice that ‘NA’ is a valid
code too, if you are not sure about the distribution of that species). A
comma-separated value file (.csv) generated in MsExcel works
particularly well. The *.csv file can be loaded into R using the
read.csv() function. In this vignette, we are loading R objects (using
the function data()) instead of nexus trees or csv files as it was
better to handle when building this vignette document. But, we provide a
line commented out on how to the file uploading should be done:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># amazilia_distribution &lt;- read.csv(file=&quot;humm_distribution.csv&quot;)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(distributioninfo)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(amazilia_distribution)</span></code></pre></div>
<pre><code>##                 species region
## 1     Amazilia_amabilis     AB
## 2     Amazilia_amazilia      A
## 3   Amazilia_berryllina     BC
## 4      Amazilia_candida     BC
## 5 Amazilia_chionogaster      A
## 6 Amazilia_chionopectus      A</code></pre>
<p>In this data set (here we see only the top lines of the data frame),
hummingbird species can live in regions A, B or C or any combination of
them. Note that first species is a multi-region one, and the proper way
to indicate it is with “AB”.</p>
<p>The second object we need is an ultrametric phylogenetic tree, that
is rooted and has labeled tips. One can load it in R by using
read.nexus(). In our example we load a prepared phylogeny named
“phylo_Vign”:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># amazilia_tree &lt;- read.nexus(&quot;amazilia_phylo.nex&quot;) # example of how to load a tree</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;phylo_Vign2&quot;</span>)</span></code></pre></div>
<p>To run LEMAD it is important that tree tip labels agree with taxon
names in the distribution file, but also that these are in the same
order. To that end, we run the following piece of code prior to any
analysis:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(amazilia_distribution) <span class="ot">&lt;-</span> amazilia_distribution<span class="sc">$</span>species</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>geiger<span class="sc">:::</span><span class="fu">name.check</span>(amazilia_tree, amazilia_distribution, <span class="at">data.names=</span><span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## [1] &quot;OK&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>amazilia_distribution<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">toupper</span>(amazilia_distribution<span class="sc">$</span>region)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>amazilia_distribution <span class="ot">&lt;-</span> amazilia_distribution[<span class="fu">order</span>(<span class="fu">match</span>(amazilia_distribution<span class="sc">$</span>species,amazilia_tree<span class="sc">$</span>tip.label)),]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>(amazilia_distribution<span class="sc">$</span>species) <span class="sc">==</span> (amazilia_tree<span class="sc">$</span>tip.label)</span></code></pre></div>
<pre><code>##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [16] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [31] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [46] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [61] TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
<p>The last line should produce a vector of only TRUE which confirms our
phylogenic tree and species distribution object match each other. Now
that our phylogenetic tree and species distribution are working fine, we
declare these variables for simplicity:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>phylotree_recons <span class="ot">&lt;-</span> amazilia_tree</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>species_presence <span class="ot">&lt;-</span> amazilia_distribution<span class="sc">$</span>region</span></code></pre></div>
<p>If the letters that are coding the distribution of species is
unsorted (e.g., BAC instead of ABC), we can run the following lines to
solve it.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for(ik in 1:length(species_presence)){</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  string_to_sort &lt;- species_presence[ik]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  species_presence[ik] &lt;- paste(sort(unlist(strsplit(string_to_sort, &quot;&quot;))), collapse = &quot;&quot;)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span></code></pre></div>
<p>We need to specify that our analysis will have three region. We do
not have to specify all the multi-region combinations.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>all_areas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>)</span></code></pre></div>
<p>Many datasets are not perfect and we have to learn to live with that.
Because LEMAD considers the lineages that went extinct (i.e., missing
branches) into the analysis, if our phylogenetic tree is incomplete
because of sampling issues, the estimation of extinction can be off.
Although LEMAD would not distinguish between missing branches due to
extinction and missing branches due to sampling (e.g., it was not
possible to obtain molecular information for all the extant species), we
can help the analysis by specifying we are aware of sampling issues in
our tree. In this example, our tree includes 80% of all the species
living in region A, the 57% of species living in B and 83% of the
species living in both. All species living region C are present in the
tree, also all the species living in AC or BC, etc. We set the following
list to set the regions that are incomplete (regions whose inhabitants
are all present in the tree, do not have to be specified)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>missing_spp_areas <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>missing_spp_areas[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;AB&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>missing_spp_areas[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.8</span>,<span class="fl">0.57</span>,<span class="fl">0.83</span>)</span></code></pre></div>
<p>Notice that the order of the second list object should match that of
the first list object. We need to set what is the maximum number of
areas where a species can take at a given point in time. This means, the
most widespread ancestor, could it be spread in A, B and C? or we limit
that lineages can only live in two regions? In the case of this group of
hummingbirds, there are few species that are indeed, present at the
three regions at the present. So, it might be safe to assume that
ancestors could achieve the same. In datasets with more regions, one
should make a decision whether a species can be truly “cosmopolitan” or
not.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>num_max_multiregion <span class="ot">&lt;-</span> <span class="dv">3</span></span></code></pre></div>
<p>By doing that line, we are saying that lineages can be present in:
“A” “B” “C” “AB” “AC” “BC” “ABC” Now, let’s imagine that we have four
regions (A,B,C,D) and we still think that the maximum number of regions
a species can simultaneously be present at is 3. This makes that all the
possible distributions are: “A” “B” “C” “D” “AB” “AC” “AD” “BC” “BD”
“CD” “ABC” “ABD” “ACD” “BCD” “ABCD”</p>
<p>Imagine we have regions A,B,C,D and E, setting the maximum number of
regions to occur at the same time has a major consequence in the total
number of potential distributions: when num_max_multiregion = 2, we get
15 different distributions when num_max_multiregion = 3, we get 25
different distributions when num_max_multiregion = 4, we get 30
different distributions</p>
<p>LEMAD, even though precise, is sort of slow. The higher the number of
potential distributions, the more equations have to be solved and the
slower the analysis is. We cannot set num_max_multiregion to 1 because
we need some (at least) two-region species because the model assumes
there are vicariance events. In LEMAD we can fit models where the
extinction rate is fixed to a certain figure. This means that the
provided rate will be plugged into the analysis. At the end, we will get
a likelihood value for such a model. When fixing the model to a
different extinction rate, the likelihood could be different. By
comparing both results, we will know which model is supported better.
Also, we can let the extinction rate be estimated during the
calculation. To do that we use the argument:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lineage_extinction &lt;- &quot;free&quot;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>lineage_extinction <span class="ot">&lt;-</span> <span class="fl">0.001</span></span></code></pre></div>
<p>Before starting the optimization (Maximum likelihood search, which
will find the combinations of rates that fit best), we can provide of
“initial values”. The search algorithm needs to start calculating the
very first likelihood using a set of rates. From there, it will try
rates that are slightly lower or higher, calculate the likelihood and
check whether those likelihoods are better than the resulting one from
the previous parameter combination. This makes the algorithm decide
which direction to take.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>initial_lambda <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.01</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>initial_disperextirpation <span class="ot">&lt;-</span> <span class="fl">0.002</span></span></code></pre></div>
<p>Those lines are saying that we want to start the ML search where
speciation is 0.01 and the rate of colonizing and disappearing from
regions is 0.002. Note that the initial lambda is a vector of length 2
because we have two types of speciation: in-situ and vicariance. We need
to provide a value for each type of speciation. If we do not have a
better initial guess, we do both 0.01. Again, these are only starting
points. If we have no clue what a sensible starting point would be, we
set both arguments to NULL and LEMAD will provide a standard starting
point (the lambda will come from fitting a birth-death model to the
phylogenetic tree). In principle, it does not matter where we start the
search, it should always converge to the same value. LEMAD allows
fitting models under the assumptions of DIVAevents or DECevets (see
Introduction). Because they are different parameterizations of the same
model, the comparison of their likelihoods is valid and straightforward
so data will inform which set of assumptions is more likely. We need to
use the variable:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>DEC_events <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># to choose DIVAevents</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or when choosing DECevents:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># DEC_events &lt;- TRUE </span></span></code></pre></div>
<p>Finally, we can incorporate information on the distribution of the
common ancestor of the whole clade. So, LEMAD will compute the
likelihood conditioned on the information we provided. To indicate that
the very first ancestor of the clade was present in area A, We do:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># condition_on_origin &lt;- A</span></span></code></pre></div>
<p>Generally, we lack this information so we normally want LEMAD not to
condition on a particular area. We do:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>condition_on_origin <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>To launch the analysis:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>output_vig <span class="ot">&lt;-</span> <span class="fu">lemad_analysis</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a> phylotree_recons,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a> species_presence,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a> <span class="at">areas =</span> all_areas,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a> num_max_multiregion,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a> condition_on_origin,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a> DEC_events,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a> <span class="at">missing_spp_areas =</span> missing_spp_areas,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a> <span class="at">lineage_extinction =</span> lineage_extinction,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a> <span class="at">initial_lambda =</span> initial_lambda,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a> <span class="at">initial_disperextirpation =</span> initial_disperextirpation)</span></code></pre></div>
<pre><code>## You are optimizing lambda0 mu0 
## You are fixing lambda1 mu1 
## Optimizing the likelihood - this may take a while. 
## The loglikelihood for the initial parameter values is -194.187109987583.
## 
## Maximum likelihood parameter estimates: lambda0: 0.154894, mu0: 0.000053, lambda1: 0.000000, mu1: 0.000000: 
## Maximum loglikelihood: -182.993983
## I am checking your input right now 
## You set some transitions as impossible to happen 
## Calculating the likelihood for the initial parameters. 
## 0.01 0.01 0.002 -548.9744 
## The loglikelihood for the initial parameter values is -548.9744 
## Optimizing the likelihood - this may take a while. 
##  
## 0.01 0.01 0.002 -548.9744 
## 0.0105 0.01 0.002 -546.6019 
## 0.01 0.0105 0.002 -548.4119 
## 0.01 0.01 0.0021 -546.7005 
## 1 0.01 0.01 0.002 -548.97441550535 initial 
## 0.01033328 0.01033328 0.002066664 -545.4738 
## 0.0105 0.0105 0.0021 -543.7672 
## 2 0.0105 0.0105 0.0021 -543.767160769443 expand 
## 0.01066678 0.009833443 0.002133338 -543.0228 
## 0.0110005 0.009500495 0.00220002 -540.4922 
## 3 0.0110004952947004 0.00950049455984174 0.00220001996207206 -540.492219677286 expand 
## 0.01133443 0.01 0.0021 -540.6179 
## 4 0.0110004952947004 0.00950049455984174 0.00220001996207206 -540.492219677286 reflect 
## 0.01139011 0.01 0.002266711 -536.8277 
## 0.01183576 0.01 0.00240012 -532.3164 
## 5 0.01183575677462 0.01 0.00240011979634621 -532.316433347482 expand 
## 0.01228179 0.009167765 0.002366764 -532.1722 
## 0.01317505 0.008502964 0.0025002 -527.1045 
## 6 0.0131750496360027 0.00850296442687747 0.00250019968051118 -527.104538527611 expand 
## 0.0126724 0.008669083 0.002633671 -526.355 
## 0.01334271 0.008004938 0.002900719 -520.3278 
## 7 0.0133427105742181 0.00800493827160494 0.00290071913703555 -520.327756870255 expand 
## 0.01457392 0.008170892 0.003000899 -514.2803 
## 0.01637012 0.007507404 0.003401819 -503.9227 
## 8 0.0163701244813279 0.00750740375123396 0.00340181872689117 -503.922709719442 expand 
## 0.01676389 0.006017743 0.00346867 -504.4043 
## 9 0.0163701244813279 0.00750740375123396 0.00340181872689117 -503.922709719442 reflect 
## 0.01781543 0.005852497 0.004014954 -495.1316 
## 0.0201516 0.00453248 0.004774049 -484.2234 
## 10 0.0201515992892049 0.00453248031496063 0.00477404936624415 -484.223436318549 expand 
## 0.02221404 0.004038367 0.00486343 -479.9882 
## 0.02670821 0.002066765 0.005847669 -469.5797 
## 11 0.0267082099144919 0.00206676485027 0.00584766929344195 -469.579653169721 expand 
## 0.02539015 0.003380305 0.005881257 -466.9052 
## 0.02975841 0.002066765 0.007091906 -455.5794 
## 12 0.0297584080717492 0.00206676485027001 0.00709190598776368 -455.579410962411 expand 
## 0.03484368 -0.001690577 0.008417988 -Inf 
## 0.0209264 0.005192055 0.004651177 -482.1215 
## 13 0.0297584080717492 0.00206676485027001 0.00709190598776368 -455.579410962411 contract inside 
## 0.03148011 0.001684297 0.006953505 -455.5558 
## 0.03723924 0.0002662529 0.008046783 -451.268 
## 14 0.0372392441751048 0.000266252858542974 0.00804678297340707 -451.268021231628 expand 
## 0.04171582 -0.002232783 0.009349077 -Inf 
## 0.02604557 0.003325505 0.005821547 -466.3245 
## 15 0.0372392441751048 0.000266252858542974 0.00804678297340707 -451.268021231628 contract inside 
## 0.03531456 0.001702503 0.00812675 -442.8423 
## 0.03967207 0.001520471 0.009270168 -432.1815 
## 16 0.0396720723893131 0.001520471024369 0.00927016804532828 -432.181543430705 expand 
## 0.04521046 -0.0007493563 0.01046012 -Inf 
## 0.0307706 0.002303677 0.006977193 -453.7598 
## 17 0.0396720723893131 0.001520471024369 0.00927016804532828 -432.181543430705 contract inside 
## 0.04207547 0.000659751 0.009104458 -435.2249 
## 18 0.0396720723893131 0.001520471024369 0.00927016804532828 -432.181543430705 reflect 
## 0.04870103 -0.0006688278 0.01064316 -Inf 
## 0.03519548 0.001558894 0.007891189 -445.0329 
## 19 0.0396720723893131 0.001520471024369 0.00927016804532828 -432.181543430705 contract inside 
## 0.04071292 0.002228069 0.009464006 -427.2309 
## 0.0424585 0.003211866 0.01017411 -419.2293 
## 20 0.0424584954928494 0.00321186588083965 0.0101741131484713 -419.229272383527 expand 
## 0.04768046 0.002033701 0.01114611 -413.429 
## 0.05403656 0.002271272 0.01278147 -401.156 
## 21 0.05403656251188 0.00227127240396863 0.0127814727028182 -401.15601810858 expand 
## 0.04864954 0.004013979 0.0123803 -403.0294 
## 22 0.05403656251188 0.00227127240396863 0.0127814727028182 -401.15601810858 reflect 
## 0.05719472 0.00481534 0.01429698 -388.7811 
## 0.06617942 0.006470918 0.01682921 -374.1944 
## 23 0.0661794168708097 0.00647091766854374 0.0168292108235157 -374.194367151919 expand 
## 0.0703862 0.005288485 0.01784091 -370.9366 
## 0.08491881 0.006330022 0.02171812 -355.3432 
## 24 0.0849188083728876 0.00633002227659516 0.0217181157636086 -355.343210906912 expand 
## 0.08855074 0.006028625 0.0218568 -353.9256 
## 0.1096621 0.007038983 0.02666189 -338.9723 
## 25 0.109662107005788 0.00703898308181782 0.0266618911403856 -338.972301060812 expand 
## 0.1213016 0.01099294 0.030819 -328.9497 
## 0.1582597 0.01541094 0.04008087 -313.5156 
## 26 0.158259688799164 0.0154109432000103 0.0400808683122385 -313.515597711291 expand 
## 0.1724477 0.01270135 0.04234437 -311.3032 
## 0.2339425 0.01584558 0.05558824 -301.1613 
## 27 0.233942483985326 0.0158455753598885 0.0555882355994984 -301.161283358906 expand 
## 0.2580114 0.01925019 0.06028198 -299.1169 
## 0.367065 0.02583549 0.08067658 -298.7196 
## 28 0.36706503664697 0.0258354945586766 0.0806765844930065 -298.719603212673 expand 
## 0.4238172 0.03126494 0.09241602 -301.3387 
## 29 0.36706503664697 0.0258354945586766 0.0806765844930065 -298.719603212673 reflect 
## 0.5802854 0.03329607 0.1145025 -313.7476 
## 0.2411222 0.01982393 0.05773868 -299.817 
## 30 0.36706503664697 0.0258354945586766 0.0806765844930065 -298.719603212673 contract inside 
## 0.1590879 0.009928405 0.03806576 -316.6527 
## 0.3469104 0.02584673 0.07830179 -297.8385 
## 31 0.346910436576592 0.0258467312516157 0.0783017942017148 -297.838492634219 contract inside 
## 0.4097207 0.03193587 0.08921796 -300.662 
## 0.3612426 0.0278657 0.08061122 -298.3409 
## 32 0.346910436576592 0.0258467312516157 0.0783017942017148 -297.838492634219 contract outside 
## 0.5000402 0.03329463 0.1029307 -307.0293 
## 0.2970942 0.02315857 0.06868589 -297.4648 
## 33 0.297094177823355 0.0231585689341044 0.068685889210909 -297.464843237197 contract inside 
## 0.3034686 0.02540468 0.07104938 -297.0665 
## 0.2738389 0.02518941 0.06629981 -297.2076 
## 34 0.303468609562347 0.0254046784602743 0.0710493758940463 -297.066475941494 reflect 
## 0.2726497 0.02175646 0.06483173 -297.7823 
## 35 0.303468609562347 0.0254046784602743 0.0710493758940463 -297.066475941494 reflect 
## 0.2394233 0.02103995 0.05825205 -299.5075 
## 0.3183279 0.0246408 0.07321847 -297.2948 
## 36 0.303468609562347 0.0254046784602743 0.0710493758940463 -297.066475941494 contract inside 
## 0.3416442 0.02705826 0.07720248 -297.7268 
## 0.3237036 0.02572766 0.07408292 -297.3623 
## 37 0.303468609562347 0.0254046784602743 0.0710493758940463 -297.066475941494 contract outside 
## 0.3336351 0.02736508 0.07690977 -297.3034 
## 38 0.303468609562347 0.0254046784602743 0.0710493758940463 -297.066475941494 reflect 
## 0.3130637 0.02587682 0.07335817 -296.9702 
## 0.3078076 0.02595142 0.07299617 -296.7976 
## 39 0.307807598707174 0.0259514202531316 0.0729961685705177 -296.797552967679 expand 
## 0.2868761 0.02330699 0.06796841 -297.2585 
## 40 0.307807598707174 0.0259514202531316 0.0729961685705177 -296.797552967679 reflect 
## 0.2808548 0.02513217 0.06812826 -296.9333 
## 41 0.307807598707174 0.0259514202531316 0.0729961685705177 -296.797552967679 reflect 
## 0.3078306 0.02769435 0.07348754 -296.6552 
## 0.3185659 0.02990218 0.07626855 -296.5845 
## 42 0.318565924803254 0.029902177127763 0.0762685538425116 -296.584488956804 expand 
## 0.3009641 0.02858232 0.07386209 -296.2462 
## 0.2997154 0.03017853 0.075274 -295.875 
## 43 0.299715390995992 0.0301785315500817 0.0752739967790935 -295.87495635191 expand 
## 0.33768 0.03223988 0.08164572 -296.677 
## 44 0.299715390995992 0.0301785315500817 0.0752739967790935 -295.87495635191 reflect 
## 0.329311 0.03563905 0.08248998 -296.0946 
## 45 0.299715390995992 0.0301785315500817 0.0752739967790935 -295.87495635191 reflect 
## 0.2945275 0.03156002 0.07438156 -295.8277 
## 0.2739787 0.03122043 0.07078594 -295.8902 
## 46 0.294527503827534 0.0315600189847708 0.0743815602825257 -295.827740787052 reflect 
## 0.2969589 0.0350185 0.07847299 -295.1298 
## 0.2864187 0.03759578 0.07957859 -294.5237 
## 47 0.286418718290774 0.0375957762093313 0.0795785907306945 -294.523689373315 expand 
## 0.2596261 0.0305762 0.07039122 -295.6473 
## 48 0.286418718290774 0.0375957762093313 0.0795785907306945 -294.523689373315 reflect 
## 0.2609047 0.03630905 0.07426774 -294.7388 
## 49 0.286418718290774 0.0375957762093313 0.0795785907306945 -294.523689373315 reflect 
## 0.2441982 0.03809661 0.075084 -294.303 
## 0.2204731 0.04139607 0.07543556 -294.2179 
## 50 0.220473148587862 0.0413960703329315 0.0754355600510688 -294.217924320722 expand 
## 0.2510863 0.04640269 0.08252209 -293.1644 
## 0.2468597 0.05449963 0.08869122 -292.4454 
## 51 0.246859693595992 0.0544996303522575 0.0886912228511712 -292.445426325004 expand 
## 0.2405932 0.05271409 0.08823615 -292.3777 
## 0.2306808 0.06111295 0.09535746 -291.7844 
## 52 0.230680821589253 0.0611129450446365 0.0953574633141106 -291.784425657044 expand 
## 0.1830588 0.06736983 0.09337189 -293.0125 
## 53 0.230680821589253 0.0611129450446365 0.0953574633141106 -291.784425657044 reflect 
## 0.2187114 0.0812899 0.1100453 -291.5183 
## 0.2178324 0.1024054 0.1281991 -292.0132 
## 54 0.218711411856894 0.0812899045590322 0.11004526368366 -291.518253311774 reflect 
## 0.2851133 0.06366262 0.1025849 -292.6621 
## 0.2579839 0.06458701 0.1002672 -291.9321 
## 55 0.218711411856894 0.0812899045590322 0.11004526368366 -291.518253311774 contract outside 
## 0.2244922 0.08374933 0.1153435 -291.429 
## 0.2136067 0.09899124 0.129165 -291.8149 
## 56 0.224492160144221 0.0837493333158168 0.115343483424363 -291.429011586268 reflect 
## 0.1929586 0.08620593 0.1135133 -291.9031 
## 0.2085764 0.0807193 0.1101719 -291.5503 
## 57 0.224492160144221 0.0837493333158168 0.115343483424363 -291.429011586268 contract outside 
## 0.204059 0.103555 0.1288428 -292.0744 
## 0.2239156 0.07141444 0.1035412 -291.487 
## 58 0.224492160144221 0.0837493333158168 0.115343483424363 -291.429011586268 contract inside 
## 0.236477 0.07687052 0.1090732 -291.4937 
## 59 0.224492160144221 0.0837493333158168 0.115343483424363 -291.429011586268 reflect 
## 0.2379751 0.0733814 0.1085524 -291.3869 
## 0.2478371 0.06947037 0.1078075 -291.4207 
## 60 0.237975085058441 0.0733814009769026 0.108552424567529 -291.386870873246 reflect 
## 0.2211389 0.07543964 0.109176 -291.329 
## 0.2136116 0.07472562 0.1092274 -291.3362 
## 61 0.221138863641027 0.0754396379786307 0.109176030431858 -291.328969266199 reflect 
## 0.2317609 0.08366492 0.1185918 -291.3811 
## 62 0.221138863641027 0.0754396379786307 0.109176030431858 -291.328969266199 reflect 
## 0.2360668 0.07127694 0.1088512 -291.2608 
## 0.2419366 0.06514779 0.1056333 -291.2702 
## 63 0.236066840655477 0.0712769440565904 0.108851177658792 -291.260847792118 reflect 
## 0.2213838 0.0801786 0.1158476 -291.2484 
## 0.2132538 0.08360959 0.1195313 -291.3004 
## 64 0.221383759171073 0.0801786003095992 0.115847616490036 -291.248360410698 reflect 
## 0.2206037 0.06769253 0.1040676 -291.3403 
## 0.223374 0.07164133 0.1076632 -291.2647 
## 65 0.221383759171073 0.0801786003095992 0.115847616490036 -291.248360410698 contract outside 
## 0.2327302 0.07326241 0.1123798 -291.1468 
## 0.2386088 0.07217709 0.1139887 -291.0974 
## 66 0.23860884892198 0.0721770940136811 0.113988666302264 -291.097423342169 expand 
## 0.2406934 0.07743299 0.1181622 -291.2162 
## 67 0.23860884892198 0.0721770940136811 0.113988666302264 -291.097423342169 reflect 
## 0.2309458 0.0819479 0.1232353 -291.1694 
## 68 0.23860884892198 0.0721770940136811 0.113988666302264 -291.097423342169 reflect 
## 0.2524773 0.07418048 0.1210631 -291.1981 
## 69 0.23860884892198 0.0721770940136811 0.113988666302264 -291.097423342169 reflect 
## 0.2405336 0.0747411 0.1206707 -291.0106 
## 0.2404536 0.07340019 0.1219292 -290.9132 
## 70 0.24045363253973 0.0734001900149753 0.121929231145157 -290.913180273581 expand 
## 0.2212288 0.07747299 0.1183458 -291.0601 
## 71 0.24045363253973 0.0734001900149753 0.121929231145157 -290.913180273581 reflect 
## 0.2358024 0.06684885 0.1129687 -290.8965 
## 0.2382451 0.05945627 0.1079055 -290.9093 
## 72 0.235802383647446 0.0668488524813753 0.112968746457684 -290.896488043245 reflect 
## 0.226333 0.07293544 0.1215082 -290.7963 
## 0.2202858 0.07331502 0.1253061 -290.7353 
## 73 0.220285802135366 0.0733150166603402 0.125306113992491 -290.735345646883 expand 
## 0.2432073 0.06495853 0.121747 -290.5926 
## 0.2544958 0.05880969 0.1234553 -290.4719 
## 74 0.254495820429473 0.0588096891399572 0.12345534120095 -290.471872898405 expand 
## 0.2329757 0.05927631 0.1191748 -290.4021 
## 0.2292705 0.05235284 0.1178026 -290.286 
## 75 0.229270474992743 0.0523528353675891 0.117802626325887 -290.285967002839 expand 
## 0.2332307 0.05604688 0.1315428 -290.0302 
## 0.2319488 0.05072751 0.1410643 -289.8157 
## 76 0.231948820670926 0.0507275119392315 0.141064314925959 -289.815707105987 expand 
## 0.2572023 0.03527487 0.1294096 -289.7531 
## 0.276511 0.01724834 0.1314726 -290.0351 
## 77 0.257202299031337 0.0352748654658614 0.129409623765147 -289.753130532832 reflect 
## 0.2245597 0.03361663 0.1352981 -289.8719 
## 78 0.257202299031337 0.0352748654658614 0.129409623765147 -289.753130532832 reflect 
## 0.2463408 0.02757474 0.1532247 -289.4897 
## 0.255055 0.01561816 0.1717911 -289.7049 
## 79 0.246340837010735 0.0275747428227948 0.153224664569198 -289.489658801279 reflect 
## 0.2662955 0.04195699 0.1470626 -289.7295 
## 80 0.246340837010735 0.0275747428227948 0.153224664569198 -289.489658801279 reflect 
## 0.2821744 0.01954641 0.1452289 -289.7399 
## 81 0.246340837010735 0.0275747428227948 0.153224664569198 -289.489658801279 reflect 
## 0.2724227 0.02400578 0.168237 -289.5248 
## 82 0.246340837010735 0.0275747428227948 0.153224664569198 -289.489658801279 reflect 
## 0.2416515 0.04296151 0.1671929 -289.7222 
## 83 0.246340837010735 0.0275747428227948 0.153224664569198 -289.489658801279 reflect 
## 0.2406204 0.02115035 0.1790665 -289.901 
## 0.2597776 0.03667624 0.1548996 -289.5228 
## 84 0.246340837010735 0.0275747428227948 0.153224664569198 -289.489658801279 contract inside 
## 0.277712 0.01616978 0.150425 -289.6739 
## 0.2685019 0.02273783 0.1545716 -289.4859 
## 85 0.268501896305451 0.0227378318907223 0.154571623910511 -289.485875767871 contract outside 
## 0.2441756 0.03397024 0.1405579 -289.5403 
## 0.2652414 0.02647885 0.161192 -289.4604 
## 86 0.265241365541338 0.0264788475883367 0.161192003023059 -289.460423456259 contract inside 
## 0.2601262 0.01474415 0.1577418 -289.6428 
## 0.2598648 0.03110481 0.1556089 -289.4529 
## 87 0.259864765894354 0.0311048149977098 0.155608851109677 -289.452882009193 contract inside 
## 0.2832496 0.0259514 0.1610354 -289.6421 
## 0.2553676 0.02716843 0.1551675 -289.4412 
## 88 0.255367550916299 0.0271684260399832 0.155167486670385 -289.441222838938 contract inside 
## 0.2518974 0.03381516 0.160074 -289.4831 
## 0.2560077 0.03102339 0.1586935 -289.4519 
## 89 0.255367550916299 0.0271684260399832 0.155167486670385 -289.441222838938 contract outside 
## 0.249017 0.03306675 0.1518216 -289.4629 
## 0.2611459 0.02811793 0.1588351 -289.4455 
## 90 0.255367550916299 0.0271684260399832 0.155167486670385 -289.441222838938 contract inside 
## 0.2551475 0.02644037 0.1595236 -289.4519 
## 0.2563235 0.02760252 0.1585424 -289.4429 
## 91 0.255367550916299 0.0271684260399832 0.155167486670385 -289.441222838938 contract outside 
## 0.2592109 0.02425784 0.1563341 -289.4512 
## 0.2584086 0.02594089 0.1569231 -289.442 
## 92 0.255367550916299 0.0271684260399832 0.155167486670385 -289.441222838938 contract outside 
## 0.2522826 0.02569186 0.1549235 -289.4624 
## 0.2589183 0.02751034 0.1578547 -289.4398 
## 93 0.258918320714725 0.027510340143088 0.157854746126411 -289.439762912272 contract inside 
## 0.2588046 0.02614407 0.1547585 -289.4414 
## 94 0.258918320714725 0.027510340143088 0.157854746126411 -289.439762912272 reflect 
## 0.2569816 0.02794229 0.1549292 -289.4374 
## 0.2562693 0.02894593 0.1539349 -289.4379 
## 95 0.256981593141943 0.0279422926271036 0.154929223190507 -289.437398144141 reflect 
## 0.255375 0.02894025 0.1572087 -289.4411 
## 96 0.256981593141943 0.0279422926271036 0.154929223190507 -289.437398144141 reflect 
## 0.2588171 0.0290946 0.1581621 -289.443 
## 0.2562282 0.02764929 0.1559147 -289.4387 
## 97 0.256981593141943 0.0279422926271036 0.154929223190507 -289.437398144141 contract inside 
## 0.2593814 0.02646396 0.1552562 -289.4401 
## 0.2583774 0.02708191 0.1557437 -289.4382 
## 98 0.256981593141943 0.0279422926271036 0.154929223190507 -289.437398144141 contract outside 
## 0.2554766 0.02760508 0.1532127 -289.4409 
## 0.2580561 0.02753402 0.1566907 -289.4381 
## 99 0.256981593141943 0.0279422926271036 0.154929223190507 -289.437398144141 contract inside 
## 0.2593853 0.02738932 0.1556602 -289.4384 
## 0.2585945 0.0274543 0.1557238 -289.4378 
## 100 0.256981593141943 0.0279422926271036 0.154929223190507 -289.437398144141 contract outside 
## 0.2573771 0.02820569 0.1558179 -289.4374 
## 0.2568776 0.0287685 0.155855 -289.4378 
## 101 0.257377107281645 0.0282056912801595 0.155817922763006 -289.437357900788 reflect 
## 0.2572456 0.02820086 0.1542921 -289.4374 
## 102 0.257377107281645 0.0282056912801595 0.155817922763006 -289.437357900788 reflect 
## 0.2558113 0.02877909 0.1543026 -289.4379 
## 0.2578976 0.02778518 0.1553682 -289.4373 
## 103 0.257897577255452 0.0277851760487367 0.155368172501174 -289.437336262006 contract inside 
## 0.2575918 0.02775462 0.1564532 -289.4379 
## 0.2573321 0.02808926 0.1548316 -289.4372 
## 104 0.25733209290475 0.0280892628857262 0.154831641518419 -289.437240798767 contract inside 
## 0.25809 0.02811108 0.1557493 -289.4374 
## 0.2572585 0.02798448 0.1551341 -289.4373 
## 105 0.25733209290475 0.0280892628857262 0.154831641518419 -289.437240798767 contract inside 
## 0.2576149 0.02770035 0.1544055 -289.4377 
## 0.2574365 0.02807931 0.1554645 -289.4372 
## 106 0.257436547721291 0.0280793095806037 0.155464489409461 -289.43722275677 contract inside 
## 0.2567877 0.028317 0.1549186 -289.4373 
## 0.257065 0.02818399 0.155031 -289.4372 
## 107 0.257064961872559 0.0281839886974584 0.155030989128599 -289.437220410553 contract outside 
## 0.2572972 0.02825059 0.1550838 -289.4372 
## 0.2573165 0.02838369 0.1550587 -289.4372 
## 108 0.257297191032065 0.0282505865532491 0.155083832612592 -289.437179221009 reflect 
## 0.2572003 0.02825333 0.1555547 -289.4373 
## 0.2572992 0.02813027 0.1550123 -289.4372 
## 109 0.257297191032065 0.0282505865532491 0.155083832612592 -289.437179221009 contract inside 
## 0.2570044 0.02829728 0.1546206 -289.4373 
## 0.2573285 0.02813379 0.1552534 -289.4372 
## 110 0.257297191032065 0.0282505865532491 0.155083832612592 -289.437179221009 contract inside 
## 0.2575517 0.02815911 0.155202 -289.4372 
## 111 0.257297191032065 0.0282505865532491 0.155083832612592 -289.437179221009 reflect 
## 0.2574857 0.02823205 0.1553472 -289.4372 
## 0.2573458 0.02815572 0.155096 -289.4372 
## 112 0.257297191032065 0.0282505865532491 0.155083832612592 -289.437179221009 contract inside 
## 0.257468 0.02824315 0.1550012 -289.4372 
## 0.2573633 0.02816113 0.1551903 -289.4372 
## 113 0.257297191032065 0.0282505865532491 0.155083832612592 -289.437179221009 contract inside 
## 0.2571193 0.02821918 0.1550448 -289.4372 
## 0.2574436 0.02817413 0.1551627 -289.4372 
## 114 0.257443551742294 0.0281741250766272 0.155162722287435 -289.437179207375 contract inside 
## 0.2573903 0.02823484 0.1551952 -289.4372 
## 115 0.257443551742294 0.0281741250766272 0.155162722287435 -289.437179207375 reflect 
## 0.2573907 0.02827858 0.1551042 -289.4372 
## 0.2573702 0.02819049 0.1551688 -289.4372 
## 116 0.257370170578682 0.0281904894888517 0.155168803024029 -289.437178245409 contract inside 
## 0.2573503 0.02817529 0.1550817 -289.4372 
## 0.2573803 0.02821995 0.1551668 -289.4372 
## 117 0.257380279932705 0.0282199548773193 0.155166841518515 -289.437177849782 contract inside 
## 0.2574988 0.02813913 0.1552484 -289.4372 
## 0.2573476 0.02822272 0.155125 -289.4372 
## 118 0.257347593451734 0.0282227205870664 0.155124975976293 -289.437177436497 contract inside 
## 0.2572885 0.02824799 0.1551444 -289.4372 
## 0.2574048 0.02819259 0.1551581 -289.4372 
## 119 0.257347593451734 0.0282227205870664 0.155124975976293 -289.437177436497 contract inside 
## 0.2573849 0.02823302 0.1551312 -289.4372 
## 0.2573812 0.02822239 0.1551406 -289.4372 
## 120 0.257347593451734 0.0282227205870664 0.155124975976293 -289.437177436497 contract outside 
## 0.2573755 0.02820518 0.1551156 -289.4372 
## 121 0.257347593451734 0.0282227205870664 0.155124975976293 -289.437177436497 reflect 
## 0.2573314 0.02824093 0.155096 -289.4372 
## 0.2573864 0.02820468 0.1551426 -289.4372 
## 122 0.257386440468958 0.0282046755050434 0.155142592076726 -289.437177402756 contract inside 
## 0.2573681 0.02822801 0.1551565 -289.4372 
## 0.2573736 0.02821089 0.1551258 -289.4372 
## 123 0.257373611132409 0.0282108856864342 0.155125829492275 -289.437177330366 contract inside 
## 0.2573572 0.02820313 0.1551217 -289.4372 
## 0.2573752 0.02821757 0.1551359 -289.4372 
## 124 0.257375228248755 0.028217574169431 0.15513585249002 -289.437177323957 contract inside 
## 0.2574093 0.02819937 0.1551445 -289.4372 
## 0.257363 0.02821688 0.1551299 -289.4372 
## 125 0.257363009832255 0.0282168828070502 0.155129866956744 -289.437177305503 contract inside 
## 0.2573548 0.02822555 0.1551184 -289.4372 
## 0.2573785 0.02820989 0.1551366 -289.4372 
## 126 0.257363009832255 0.0282168828070502 0.155129866956744 -289.437177305503 contract inside 
## 0.2573709 0.02821868 0.1551424 -289.4372 
## 0.2573729 0.02821283 0.15513 -289.4372 
## 127 0.257372933290831 0.0282128348017731 0.155129960327924 -289.437177299566 contract inside 
## 0.2573678 0.02820883 0.1551284 -289.4372 
## 0.2573734 0.02821539 0.155134 -289.4372 
## 128 0.257373359354948 0.0282153891495731 0.155133989811204 -289.437177297945 contract inside 
## 0.257361 0.02822018 0.155126 -289.4372 
## 0.2573741 0.02821247 0.1551339 -289.4372 
## 129 0.257374147909612 0.0282124652013456 0.155133913252994 -289.437177297349 contract inside 
## 0.257384 0.02821024 0.1551354 -289.4372 
## 0.2573682 0.02821522 0.1551312 -289.4372 
## 130 0.257368244986795 0.0282152229254723 0.155131244040551 -289.437177292404 contract inside 
## 0.2573709 0.02821588 0.1551361 -289.4372 
## 0.2573724 0.0282136 0.1551315 -289.4372 
## 131 0.257368244986795 0.0282152229254723 0.155131244040551 -289.437177292404 contract inside 
## 0.2573699 0.02821213 0.1551305 -289.4372 
## 0.2573725 0.02821458 0.1551331 -289.4372 
## 132 0.257368244986795 0.0282152229254723 0.155131244040551 -289.437177292404 contract inside 
## 0.257368 0.02821646 0.15513 -289.4372 
## 0.2573695 0.02821547 0.155131 -289.4372 
## 133 0.257369502572969 0.0282154650465392 0.155130970351223 -289.437177292147 contract outside 
## 0.2573677 0.02821658 0.155132 -289.4372 
## 0.2573713 0.02821434 0.1551316 -289.4372 
## 134 0.257369502572969 0.0282154650465392 0.155130970351223 -289.437177292147 contract inside 
## 0.2573668 0.02821544 0.1551295 -289.4372 
## 0.2573711 0.02821479 0.1551322 -289.4372 
## 135 0.257371074457678 0.0282147927664024 0.15513219483822 -289.437177291827 contract inside 
## 0.257373 0.02821451 0.155132 -289.4372 
## 0.2573694 0.02821504 0.1551314 -289.4372 
## 136 0.25736942717255 0.0282150448265311 0.155131422708888 -289.437177291647 contract inside 
## 0.2573688 0.02821586 0.1551314 -289.4372 
## 0.2573706 0.02821472 0.1551316 -289.4372 
## 137 0.25736942717255 0.0282150448265311 0.155131422708888 -289.437177291647 contract inside 
## 0.2573712 0.02821424 0.1551325 -289.4372 
## 138 0.25736942717255 0.0282150448265311 0.155131422708888 -289.437177291647 reflect 
## 0.2573698 0.02821455 0.1551315 -289.4372 
## 139 0.25736942717255 0.0282150448265311 0.155131422708888 -289.437177291647 reflect 
## 0.2573686 0.0282153 0.1551305 -289.4372 
## 0.2573706 0.02821451 0.155132 -289.4372 
## 140 0.257370599236746 0.0282145058917104 0.155131995630202 -289.43717729154 contract inside 
## 0.2573693 0.02821468 0.1551317 -289.4372 
## 0.2573696 0.02821469 0.1551317 -289.4372 
## 141 0.257370599236746 0.0282145058917104 0.155131995630202 -289.43717729154 contract outside 
## 0.25737 0.02821495 0.1551319 -289.4372 
## 0.25737 0.02821515 0.1551321 -289.4372 
## 142 0.257369954980766 0.0282149464426217 0.155131907187144 -289.437177291437 reflect 
## 0.2573707 0.02821438 0.1551323 -289.4372 
## 143 0.257369954980766 0.0282149464426217 0.155131907187144 -289.437177291437 reflect 
## 0.2573712 0.02821454 0.1551325 -289.4372 
## 0.25737 0.02821465 0.1551319 -289.4372 
## 144 0.257369954980766 0.0282149464426217 0.155131907187144 -289.437177291437 contract inside 
## 0.2573698 0.02821481 0.155132 -289.4372 
## 0.2573694 0.02821497 0.1551321 -289.4372 
## 145 0.257369822028947 0.0282148123776772 0.155132035946025 -289.437177291398 reflect 
## 0.2573692 0.02821522 0.1551316 -289.4372 
## 0.2573703 0.02821459 0.1551321 -289.4372 
## 146 0.257369822028947 0.0282148123776772 0.155132035946025 -289.437177291398 contract inside 
## 0.25737 0.02821492 0.1551322 -289.4372 
## 147 0.257369822028947 0.0282148123776772 0.155132035946025 -289.437177291398 reflect 
## 0.2573702 0.0282146 0.1551323 -289.4372 
## 0.2573703 0.02821443 0.1551325 -289.4372 
## 148 0.257370158709455 0.0282146019210756 0.155132306059726 -289.437177291391 reflect 
## 0.2573697 0.02821496 0.1551322 -289.4372 
## 0.2573702 0.02821468 0.1551321 -289.4372 
## 149 0.257370154948955 0.028214684802031 0.155132140297922 -289.437177291387 contract inside 
## 0.25737 0.02821448 0.1551321 -289.4372 
## 0.25737 0.02821481 0.1551322 -289.4372 
## 150 0.257370046755519 0.028214808847609 0.155132168381624 -289.43717729138 contract inside 
## 0.2573704 0.02821458 0.1551324 -289.4372 
## 0.25737 0.02821476 0.1551321 -289.4372 
## 151 0.257370046755519 0.028214808847609 0.155132168381624 -289.43717729138 contract inside 
## 0.25737 0.0282149 0.155132 -289.4372 
## 0.2573701 0.02821468 0.1551322 -289.4372 
## 152 0.25737010815271 0.0282146758105742 0.15513222454804 -289.43717729138 contract inside 
## 0.2573699 0.02821481 0.1551322 -289.4372 
## 153 0.25737010815271 0.0282146758105742 0.15513222454804 -289.43717729138 reflect 
## 0.2573701 0.02821477 0.1551323 -289.4372 
## 0.2573701 0.02821478 0.1551324 -289.4372 
## 154 0.25737008488571 0.0282147733907221 0.155132276151271 -289.437177291377 reflect 
## Optimization has terminated successfully.</code></pre>
<p>This vignette runs the analysis itself. You will see all the loglik
values that are tried out during the optimization.That is what you
normally see in your console when running an analysis. I will now show
what the output is like.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>output_vig<span class="sc">$</span>model_ml</span></code></pre></div>
<pre><code>## [1] -289.4372</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>output_vig<span class="sc">$</span>number_free_pars</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>With the information from “output model_ml” and “output
number_free_pars” we can compare across models using AIC. We can see the
rates of the model, those are the rates that maximize the
likelihood.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>output_vig<span class="sc">$</span>estimated_rates</span></code></pre></div>
<pre><code>##          in-situ       vicariance    disper-extirp Fixed_extinction 
##       0.25737008       0.02821477       0.15513228       0.00100000</code></pre>
<p>In-situ speciation is estimated to be higher than vicariance. And,
extinction is fixed at 0.001 as we set it up. output$ancestral_states
will provide the probability of each ancestor (internal node) being at
each region (or combination of regions), here is the first lines of such
an object:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(output_vig<span class="sc">$</span>ancestral_states)</span></code></pre></div>
<pre><code>##            A         B         C         AB         AC         BC        ABC
## 67 0.2681845 0.2841607 0.2956524 0.03027361 0.03091102 0.03178617 0.05903153
## 68 0.2629807 0.2637889 0.2620854 0.02887412 0.02878074 0.02882495 0.12466515
## 69 0.2615897 0.2742949 0.2487302 0.02936552 0.02796360 0.02863464 0.12942147
## 70 0.2569954 0.2764418 0.2934954 0.02923703 0.03032820 0.03134437 0.08215779
## 71 0.2694333 0.2701940 0.2530013 0.02957935 0.02862709 0.02867078 0.12049416
## 72 0.2752457 0.2808611 0.2335341 0.03048077 0.02786941 0.02815766 0.12385133</code></pre>
<p>Those are the probabilities for the internal nodes 67, 68 up to 72.
Now, one can use a function to plot those values into our phylogenetic
tree (function not provided in LEMAD yet, but soon ).</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
